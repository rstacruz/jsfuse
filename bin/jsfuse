#!/usr/bin/env node

var m, jsfuse = require('..'), argv = process.argv.slice(2), options = {};

if (argv[0] === '--bare' || argv[0] === '-b') {
  argv.shift();
  options.bare = true;
}

var fname = argv.shift();
if (!fname) {
  console.error("Usage: jsfuse FILE");
  process.exit(1);
}

try {
  console.log(jsfuse(fname, options));
} catch (e) {
  if (m = e.message.match(/^jsfuse\(\): (.*)$/)) {
    console.error(" ! ERR:", m[1]);
    process.exit(16);
  } else if (m = e.syscall) {
    console.error(" ! ERR:", e.message);
    process.exit(16);
  } else {
    throw(e);
  }
}
